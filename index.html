<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>チャットルーム</title>
<style>
body {
    font-family: Arial, sans-serif;
    background-color: #1e1e1e;
    color: #fff;
    margin: 0;
    padding: 0;
}
.hidden {
    display: none;
}
#check-container {
    padding: 20px;
    max-width: 500px;
    margin: auto;
    background: #2c2c2c;
    border-radius: 10px;
    margin-top: 50px;
}
button {
    padding: 8px 16px;
    margin: 5px;
    cursor: pointer;
    border: none;
    border-radius: 5px;
}
.chat-container {
    max-width: 800px;
    margin: auto;
    padding: 20px;
}
.message {
    padding: 10px;
    margin: 8px 0;
    border-radius: 5px;
}
.tomori { background-color: #ff6666; color: white; }
.hibiki { background-color: #66a3ff; color: white; }
.hitomi { background-color: #ffcc66; color: black; }
.en { background-color: #99cc99; color: black; }
textarea {
    width: 100%;
    height: 60px;
    margin-top: 10px;
}
</style>
</head>
<body>

<!-- 年齢・反社チェック -->
<div id="check-container">
    <div id="step1">
        <h2>あなたは20歳以上ですか？</h2>
        <button onclick="checkStep(1,true)">はい</button>
        <button onclick="checkStep(1,false)">いいえ</button>
    </div>
    <div id="step2" class="hidden">
        <h2>あなたは反社会的勢力に関与していませんか？</h2>
        <button onclick="checkStep(2,true)">はい</button>
        <button onclick="checkStep(2,false)">いいえ</button>
    </div>
</div>

<!-- チャット画面 -->
<div class="chat-container hidden" id="chat-container">
    <div id="chat-box"></div>
    <textarea id="message-input" placeholder="メッセージを入力…"></textarea>
    <button id="sendBtn">送信</button>
</div>

<script>
function checkStep(step, answer) {
    if (!answer) {
        alert("申し訳ありませんが、ご利用いただけません。");
        return;
    }
    if (step === 1) {
        document.getElementById("step1").classList.add("hidden");
        document.getElementById("step2").classList.remove("hidden");
    } else if (step === 2) {
        localStorage.setItem("checkPassed", Date.now());
        document.getElementById("check-container").classList.add("hidden");
        document.getElementById("chat-container").classList.remove("hidden");
    }
}

// 30日間記憶
window.onload = function() {
    const passedTime = localStorage.getItem("checkPassed");
    if (passedTime && Date.now() - passedTime < 30*24*60*60*1000) {
        document.getElementById("check-container").classList.add("hidden");
        document.getElementById("chat-container").classList.remove("hidden");
    }
};

// チャット処理
document.getElementById("sendBtn").addEventListener("click", send);
document.getElementById("message-input").addEventListener("keydown", function(e) {
    if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        send();
    }
});

function send() {
    const input = document.getElementById("message-input");
    const text = input.value.trim();
    if (text === "") return;

    const characters = ["tomori", "hibiki", "hitomi", "en"];
    const randomCharacter = characters[Math.floor(Math.random() * characters.length)];

    const msg = document.createElement("div");
    msg.className = "message " + randomCharacter;
    msg.textContent = getName(randomCharacter) + "：「" + text + "」";
    document.getElementById("chat-box").appendChild(msg);
    input.value = "";
}

function getName(key) {
    switch (key) {
        case "tomori": return "灯（平井灯）";
        case "hibiki": return "響";
        case "hitomi": return "瞳";
        case "en": return "縁";
    }
}
</script>

</body>
</html>
